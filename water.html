<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Su Tüketimi</title>
  <link rel="stylesheet" href="stylewater.css">
</head>
<body>
  <div class="container">
    <h1>Günlük Su Tüketimi</h1>
    <div class="water-tracker">
      <p>Bugün içtiğiniz su miktarı:</p>
      <h2 id="water-amount">0.0 Litre</h2>
      <div class="buttons">
        <button id="decrease-btn">- 500ml</button>
        <button id="increase-btn">+ 500ml</button>
      </div>
    </div>
    <button id="home-btn" onclick="window.location.href='user.html'">Ana Sayfa</button>
  </div>
  <script>
    const apiUrl = 'http://127.0.0.1:5102/api/Member'; // API URL'sini buraya ekleyin
    let userId = null; // Kullanıcı ID'si başlangıçta null
    let waterAmount = 0;

    // Kullanıcı bilgilerini API'den al
    async function fetchUserInfo() {
      try {
        // Kullanıcı kimlik doğrulama bilgisi (örneğin token) ile API çağrısı yap
        const response = await fetch(`${apiUrl}`, {
          method: 'GET',
          headers: {
            'Authorization': `Bearer ${localStorage.getItem('token')}`, // Token kullanımı
            'Content-Type': 'application/json',
          },
        });

        if (!response.ok) {
          throw new Error('Kullanıcı bilgileri alınamadı.');
        }

        const data = await response.json();
        userId = data.id; // API'den gelen kullanıcı ID'sini al
        waterAmount = data.amountOfWater || 0; // API'den gelen amountOfWater bilgisini al
        updateWaterAmount();
      } catch (error) {
        console.error('Kullanıcı bilgileri alınırken hata oluştu:', error);
      }
    }

    // API'ye su tüketimini güncelle
    async function updateWaterAmountInApi() {
      try {
        await fetch(`${apiUrl}/SetMemberInfo`, {
          method: 'POST',
          headers: {
            'Authorization': `Bearer ${localStorage.getItem('token')}`, // Token kullanımı
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({
            id: userId, // Dinamik olarak alınan kullanıcı ID'si
            amountOfWater: waterAmount, // Güncellenen su miktarı
          }),
        });
      } catch (error) {
        console.error('Su tüketimi güncellenirken hata oluştu:', error);
      }
    }

    // Su miktarını güncelle ve ekranda göster
    function updateWaterAmount() {
      document.getElementById('water-amount').textContent = `${waterAmount.toFixed(1)} Litre`;
    }

    // Artırma butonu
    document.getElementById('increase-btn').addEventListener('click', async function() {
      waterAmount += 0.5;
      updateWaterAmount();
      await updateWaterAmountInApi();
    });

    // Azaltma butonu
    document.getElementById('decrease-btn').addEventListener('click', async function() {
      if (waterAmount > 0) {
        waterAmount -= 0.5;
        updateWaterAmount();
        await updateWaterAmountInApi();
      }
    });

    // Sayfa yüklendiğinde kullanıcı bilgilerini al
    fetchUserInfo();
  </script>
</body>
</html>