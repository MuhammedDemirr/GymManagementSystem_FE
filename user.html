<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>GHOST GYM - Ãœye Paneli</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <div class="container">
    <header>
      <h1>GHOST GYM <span>(<span id="header-user-name">KullanÄ±cÄ± AdÄ±</span>)</span></h1>
      <p>Salon Doluluk OranÄ±: <strong>%1</strong> ğŸ§â€â™‚ï¸<strong>%1</strong></p>
      <p class="notice">Uygulama Bildirimleriniz aÃ§Ä±k deÄŸil. AÃ§mak iÃ§in tÄ±klayÄ±nÄ±z.</p>
    </header>

    <div class="profile">
      <div class="avatar"></div>
      <div class="info-box">
        <h2 id="profile-user-name">KullanÄ±cÄ± AdÄ±</h2>
        <p>Bakiye: <strong id="user-balance">0 TL</strong></p>
        <p id="user-subscription">Aktif AboneliÄŸiniz Ã‡Ã¶zÃ¼kmemektedir</p>
      </div>
    </div>
    
    <div class="grid">
      <a href="subscribe.html" class="card yellow">Abonelik DetaylarÄ±nÄ±z</a>
      <a href="training.html" class="card pink">Antrenman</a>
      <a href="appointment.html" class="card green">Randevu Al</a>
      <a href="diet.html" class="card blue">Diyet ProgramÄ±m</a>
      <a href="water.html" class="card orange2">Su TÃ¼ketimi</a>
    </div>

    <footer>
      <a href="#">Ana Sayfa</a>
      <a href="#">HesabÄ±nÄ±z</a>
      <a href="help.html">YardÄ±m</a>
    </footer>
  </div>

  <script>
    const userId = localStorage.getItem('userId');

if (!userId) {
  console.error('KullanÄ±cÄ± kimliÄŸi bulunamadÄ±. GiriÅŸ sayfasÄ±na yÃ¶nlendiriliyor...');
  window.location.href = 'index.html';
} else {
  console.log('KullanÄ±cÄ± KimliÄŸi:', userId);

  // API URL'sini tanÄ±mlayÄ±n
  const url = `https://localhost:7034/api/Manager/GetUniqueMember?id=${userId}`;  // KullanÄ±cÄ± kimliÄŸi ile API Ã§aÄŸrÄ±sÄ±

  // API'yi Ã§aÄŸÄ±rÄ±n
  fetch(url, {
    method: 'PUT',  // PUT metodu kullanÄ±lÄ±yor
    headers: {
      'Content-Type': 'application/json',
    },
    body: JSON.stringify({ id: userId }) // API'nin beklediÄŸi formatta bir body gÃ¶nderin
  })
  .then(response => {
    if (!response.ok) {
      throw new Error('KullanÄ±cÄ± bilgileri alÄ±namadÄ±.');
    }
    return response.json();
  })
  .then(user => {
  console.log('KullanÄ±cÄ± Bilgileri:', user);
  document.getElementById('header-user-name').textContent = user.nameSurname || 'KullanÄ±cÄ± AdÄ±';
  document.getElementById('profile-user-name').textContent = user.nameSurname || 'KullanÄ±cÄ± AdÄ±';
  document.getElementById('user-balance').textContent = user.balance || '0 TL';

  // Abonelik sÃ¼resini kontrol et ve gÃ¼ncelle
  if (user.membershipPeriod && user.membershipPeriod > 0) {
    document.getElementById('user-subscription').textContent = `AboneliÄŸiniz ${user.membershipPeriod} gÃ¼n geÃ§erlidir.`;
  } else {
    document.getElementById('user-subscription').textContent = 'Aktif AboneliÄŸiniz GÃ¶zÃ¼kmemektedir';
  }
})
  .catch(error => {
    console.error('Hata:', error);
    alert('KullanÄ±cÄ± bilgileri alÄ±nÄ±rken bir hata oluÅŸtu. LÃ¼tfen tekrar giriÅŸ yapÄ±n.');
    window.location.href = 'index.html';
  });
}

  </script>
</body>
</html>
